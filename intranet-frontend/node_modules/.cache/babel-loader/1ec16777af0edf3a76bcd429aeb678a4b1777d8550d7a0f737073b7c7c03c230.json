{"ast":null,"code":"import \"core-js/modules/es.array.push.js\";\nimport axios from 'axios';\nimport { Modal } from 'bootstrap';\nimport Swal from 'sweetalert2';\nexport default {\n  name: 'DatosUsuario',\n  // CAMBIO: Async setup para pre-cargar datos\n  async setup() {\n    const userData = await fetchUserData();\n    return {\n      initialUserData: userData\n    };\n  },\n  data() {\n    return {\n      // Datos del usuario - inicializados con datos async\n      user: this.initialUserData || {\n        id: null,\n        nombre: '',\n        correo_electronico: '',\n        cargo: '',\n        posicion: '',\n        cedula: '',\n        extension: '',\n        estado: '',\n        departamento: '',\n        tiempo_extra: '',\n        firma_path: null,\n        firma_url: null\n      },\n      // Datos para edición\n      editUser: {\n        nombre: '',\n        cargo: '',\n        posicion: '',\n        extension: ''\n      },\n      // Archivos de firma\n      firmaFile: null,\n      editFirmaFile: null,\n      firmaPreview: null,\n      // Instancias de modales\n      editModalInstance: null,\n      firmaModalInstance: null,\n      // Estados de carga\n      isLoading: false,\n      isUpdating: false,\n      isUploading: false,\n      // Errores de validación\n      editErrors: {}\n    };\n  },\n  mounted() {\n    // Inicializar datos de edición\n    this.editUser = {\n      nombre: this.user.nombre || '',\n      cargo: this.user.cargo || '',\n      posicion: this.user.posicion || '',\n      extension: this.user.extension || ''\n    };\n\n    // Inicializar modales\n    this.$nextTick(() => {\n      this.editModalInstance = new Modal(document.getElementById('editModal'));\n      this.firmaModalInstance = new Modal(document.getElementById('firmaModal'));\n    });\n  },\n  methods: {\n    /**\r\n     * Obtener datos del usuario autenticado\r\n     */\n    async fetchUserData() {\n      this.isLoading = true;\n      try {\n        const token = localStorage.getItem('auth_token');\n        if (!token) {\n          this.$router.push('/login');\n          return;\n        }\n        const response = await axios.get('http://localhost:8000/api/information_user', {\n          headers: {\n            'Authorization': `Bearer ${token}`\n          }\n        });\n        if (response.data.status) {\n          this.user = response.data.data;\n          this.editUser = {\n            nombre: this.user.nombre || '',\n            cargo: this.user.cargo || '',\n            posicion: this.user.posicion || '',\n            extension: this.user.extension || ''\n          };\n        } else {\n          throw new Error(response.data.message || 'Error al obtener datos');\n        }\n        this.$nextTick(() => {\n          this.editModalInstance = new Modal(document.getElementById('editModal'));\n          this.firmaModalInstance = new Modal(document.getElementById('firmaModal'));\n        });\n      } catch (error) {\n        console.error('Error al cargar datos del usuario:', error);\n        if (error.response?.status === 401) {\n          localStorage.removeItem('auth_token');\n          this.$router.push('/login');\n          return;\n        }\n        Swal.fire({\n          icon: 'error',\n          title: 'Error',\n          text: error.response?.data?.message || 'Error al cargar sus datos'\n        });\n      } finally {\n        this.isLoading = false;\n      }\n    },\n    /**\r\n     * Actualizar datos básicos del usuario\r\n     */\n    async updateUserData() {\n      this.isUpdating = true;\n      this.editErrors = {};\n      try {\n        const token = localStorage.getItem('auth_token');\n\n        // Actualizar datos básicos del usuario\n        const updateResponse = await axios.put('http://localhost:8000/api/edit_information', this.editUser, {\n          headers: {\n            'Authorization': `Bearer ${token}`\n          }\n        });\n        if (!updateResponse.data.status) {\n          throw new Error(updateResponse.data.message || 'Error al actualizar datos');\n        }\n\n        // Si hay una nueva firma, subirla\n        if (this.editFirmaFile) {\n          const formData = new FormData();\n          formData.append('firma', this.editFirmaFile);\n          const firmaResponse = await axios.post('http://localhost:8000/api/upload-firma', formData, {\n            headers: {\n              'Authorization': `Bearer ${token}`,\n              'Content-Type': 'multipart/form-data'\n            }\n          });\n          if (firmaResponse.data.success && firmaResponse.data.data?.user) {\n            // Actualizar datos del usuario con la nueva firma\n            Object.assign(this.user, firmaResponse.data.data.user);\n          }\n        }\n\n        // Actualizar datos locales\n        Object.assign(this.user, this.editUser);\n\n        // Cerrar modal de forma más robusta\n        this.closeModal('editModal');\n        this.resetEditForm();\n\n        // Mostrar mensaje de éxito\n        await Swal.fire({\n          icon: 'success',\n          title: 'Datos actualizados',\n          text: 'Los datos se han actualizado correctamente',\n          timer: 2000,\n          showConfirmButton: false,\n          allowOutsideClick: true,\n          allowEscapeKey: true\n        });\n\n        // Recargar datos para asegurar sincronización\n        await this.fetchUserData();\n      } catch (error) {\n        console.error('Error al actualizar datos:', error);\n        if (error.response?.status === 422) {\n          this.editErrors = error.response.data.errors || {};\n        }\n        await Swal.fire({\n          icon: 'error',\n          title: 'Error',\n          text: error.response?.data?.message || 'Ha ocurrido un error al actualizar los datos',\n          allowOutsideClick: true,\n          allowEscapeKey: true\n        });\n      } finally {\n        this.isUpdating = false;\n        // Asegurar que no queden modales abiertos\n        this.removeModalBackdrops();\n      }\n    },\n    /**\r\n     * Manejar selección de archivo de firma (modal principal)\r\n     */\n    handleFirmaFile(e) {\n      const file = e.target.files[0];\n      if (file) {\n        // Validar tamaño (2MB)\n        if (file.size > 2 * 1024 * 1024) {\n          Swal.fire({\n            icon: 'warning',\n            title: 'Archivo muy grande',\n            text: 'El archivo debe ser menor a 2MB'\n          });\n          e.target.value = '';\n          return;\n        }\n        this.firmaFile = file;\n\n        // Crear preview de la imagen\n        const reader = new FileReader();\n        reader.onload = event => {\n          this.firmaPreview = event.target.result;\n        };\n        reader.readAsDataURL(file);\n      } else {\n        this.firmaFile = null;\n        this.firmaPreview = null;\n      }\n    },\n    /**\r\n     * Manejar selección de archivo de firma (modal de edición)\r\n     */\n    handleEditFirmaFile(e) {\n      const file = e.target.files[0];\n      if (file && file.size > 2 * 1024 * 1024) {\n        Swal.fire({\n          icon: 'warning',\n          title: 'Archivo muy grande',\n          text: 'El archivo debe ser menor a 2MB'\n        });\n        e.target.value = '';\n        return;\n      }\n      this.editFirmaFile = file;\n    },\n    /**\r\n     * Subir firma digital\r\n     */\n    async uploadFirma() {\n      if (!this.firmaFile) {\n        Swal.fire({\n          icon: 'warning',\n          title: 'Atención',\n          text: 'Por favor selecciona un archivo de imagen'\n        });\n        return;\n      }\n      this.isUploading = true;\n      const formData = new FormData();\n      formData.append('firma', this.firmaFile);\n      try {\n        const token = localStorage.getItem('auth_token');\n        const response = await axios.post('http://localhost:8000/api/upload-firma', formData, {\n          headers: {\n            'Authorization': `Bearer ${token}`,\n            'Content-Type': 'multipart/form-data'\n          }\n        });\n        console.log('Respuesta del servidor:', response.data);\n\n        // Actualizar el usuario con la nueva firma\n        if (response.data.success && response.data.data) {\n          if (response.data.data.user) {\n            // Actualizar con los datos completos del usuario desde el servidor\n            Object.assign(this.user, response.data.data.user);\n          } else if (response.data.data.firma_path) {\n            // Actualizar solo la firma\n            this.user.firma_path = response.data.data.firma_path;\n            this.user.firma_url = response.data.data.firma_url;\n          }\n        }\n\n        // Cerrar modal de forma más robusta\n        this.closeModal('firmaModal');\n        this.resetFirmaForm();\n\n        // Mostrar mensaje de éxito\n        await Swal.fire({\n          icon: 'success',\n          title: this.user.firma_path ? 'Firma actualizada' : 'Firma registrada',\n          text: 'Tu firma se ha guardado correctamente',\n          timer: 2000,\n          showConfirmButton: false,\n          allowOutsideClick: true,\n          allowEscapeKey: true\n        });\n\n        // Recargar datos para asegurar sincronización\n        await this.fetchUserData();\n      } catch (error) {\n        console.error('Error al subir firma:', error);\n        let errorMessage = 'Error al subir la firma';\n        if (error.response?.data?.message) {\n          errorMessage = error.response.data.message;\n        } else if (error.response?.data?.errors) {\n          const errors = Object.values(error.response.data.errors).flat();\n          errorMessage = errors.join(', ');\n        }\n        await Swal.fire({\n          icon: 'error',\n          title: 'Error',\n          text: errorMessage,\n          allowOutsideClick: true,\n          allowEscapeKey: true\n        });\n      } finally {\n        this.isUploading = false;\n        // Asegurar que no queden modales abiertos\n        this.removeModalBackdrops();\n      }\n    },\n    /**\r\n     * Resetear formulario de firma\r\n     */\n    resetFirmaForm() {\n      this.firmaFile = null;\n      this.firmaPreview = null;\n      const input = document.getElementById('firmaInput');\n      if (input) input.value = '';\n    },\n    /**\r\n     * Resetear formulario de edición\r\n     */\n    resetEditForm() {\n      this.editFirmaFile = null;\n      this.editErrors = {};\n      const editFirmaInput = document.getElementById('editFirma');\n      if (editFirmaInput) editFirmaInput.value = '';\n    },\n    /**\r\n     * Cerrar modal de forma más robusta\r\n     */\n    closeModal(modalId) {\n      try {\n        const modalElement = document.getElementById(modalId);\n        if (modalElement) {\n          const modalInstance = Modal.getInstance(modalElement);\n          if (modalInstance) {\n            modalInstance.hide();\n          }\n\n          // Forzar el cierre del modal\n          modalElement.classList.remove('show');\n          modalElement.style.display = 'none';\n          modalElement.setAttribute('aria-hidden', 'true');\n          modalElement.removeAttribute('aria-modal');\n          modalElement.removeAttribute('role');\n        }\n\n        // Remover backdrops que puedan haber quedado\n        this.removeModalBackdrops();\n\n        // Restaurar el scroll del body\n        document.body.classList.remove('modal-open');\n        document.body.style.overflow = '';\n        document.body.style.paddingRight = '';\n      } catch (error) {\n        console.error('Error al cerrar modal:', error);\n        // Método de emergencia - forzar limpieza\n        this.forceCloseAllModals();\n      }\n    },\n    /**\r\n     * Remover todos los backdrops de modales\r\n     */\n    removeModalBackdrops() {\n      const backdrops = document.querySelectorAll('.modal-backdrop');\n      backdrops.forEach(backdrop => {\n        backdrop.remove();\n      });\n    },\n    /**\r\n     * Método de emergencia para cerrar todos los modales\r\n     */\n    forceCloseAllModals() {\n      // Remover todas las clases y elementos relacionados con modales\n      document.body.classList.remove('modal-open');\n      document.body.style.overflow = '';\n      document.body.style.paddingRight = '';\n\n      // Cerrar todos los modales\n      const modals = document.querySelectorAll('.modal');\n      modals.forEach(modal => {\n        modal.classList.remove('show');\n        modal.style.display = 'none';\n        modal.setAttribute('aria-hidden', 'true');\n        modal.removeAttribute('aria-modal');\n        modal.removeAttribute('role');\n      });\n\n      // Remover todos los backdrops\n      this.removeModalBackdrops();\n    }\n  }\n};\n\n// FUNCIÓN AUXILIAR ASYNC - Para pre-cargar datos\nasync function fetchUserData() {\n  try {\n    const token = localStorage.getItem('auth_token');\n    if (!token) {\n      // La redirección será manejada por el router guard o el componente padre\n      throw new Error('No token found');\n    }\n    const response = await axios.get('http://localhost:8000/api/information_user', {\n      headers: {\n        'Authorization': `Bearer ${token}`\n      }\n    });\n    if (response.data.status) {\n      return response.data.data;\n    } else {\n      throw new Error(response.data.message || 'Error al obtener datos');\n    }\n  } catch (error) {\n    console.error('Error al cargar datos del usuario:', error);\n    if (error.response?.status === 401) {\n      localStorage.removeItem('auth_token');\n      // El router o componente padre manejará la redirección\n    }\n\n    // Retornar datos por defecto para evitar errores\n    return {\n      id: null,\n      nombre: '',\n      correo_electronico: '',\n      cargo: '',\n      posicion: '',\n      cedula: '',\n      extension: '',\n      estado: '',\n      departamento: '',\n      tiempo_extra: '',\n      firma_path: null,\n      firma_url: null\n    };\n  }\n}","map":{"version":3,"names":["axios","Modal","Swal","name","setup","userData","fetchUserData","initialUserData","data","user","id","nombre","correo_electronico","cargo","posicion","cedula","extension","estado","departamento","tiempo_extra","firma_path","firma_url","editUser","firmaFile","editFirmaFile","firmaPreview","editModalInstance","firmaModalInstance","isLoading","isUpdating","isUploading","editErrors","mounted","$nextTick","document","getElementById","methods","token","localStorage","getItem","$router","push","response","get","headers","status","Error","message","error","console","removeItem","fire","icon","title","text","updateUserData","updateResponse","put","formData","FormData","append","firmaResponse","post","success","Object","assign","closeModal","resetEditForm","timer","showConfirmButton","allowOutsideClick","allowEscapeKey","errors","removeModalBackdrops","handleFirmaFile","e","file","target","files","size","value","reader","FileReader","onload","event","result","readAsDataURL","handleEditFirmaFile","uploadFirma","log","resetFirmaForm","errorMessage","values","flat","join","input","editFirmaInput","modalId","modalElement","modalInstance","getInstance","hide","classList","remove","style","display","setAttribute","removeAttribute","body","overflow","paddingRight","forceCloseAllModals","backdrops","querySelectorAll","forEach","backdrop","modals","modal"],"sources":["C:\\xampp\\htdocs\\intranet\\intranet-frontend\\src\\components\\Datos_Usuario.vue"],"sourcesContent":["<template>\r\n  <div class=\"container\">\r\n    <div class=\"col-md-12\">\r\n      <div class=\"card\">\r\n        <!-- Header del Card -->\r\n        <div class=\"card-header d-flex justify-content-between align-items-center\">\r\n          <h5 class=\"mb-0\">Datos personales</h5>\r\n          <div class=\"btn-group\">\r\n            <button\r\n                type=\"button\"\r\n                class=\"btn btn-primary\"\r\n                data-bs-toggle=\"modal\"\r\n                data-bs-target=\"#editModal\"\r\n                :disabled=\"isLoading\"\r\n            >\r\n              <i class=\"fas fa-edit me-1\"></i>Editar\r\n            </button>\r\n            <button\r\n                v-if=\"!user.firma_path\"\r\n                type=\"button\"\r\n                class=\"btn btn-outline-success ms-2\"\r\n                data-bs-toggle=\"modal\"\r\n                data-bs-target=\"#firmaModal\"\r\n                :disabled=\"isLoading\"\r\n            >\r\n              <i class=\"fas fa-signature me-1\"></i>Registrar firma\r\n            </button>\r\n            <button\r\n                v-else\r\n                type=\"button\"\r\n                class=\"btn btn-outline-warning ms-2\"\r\n                data-bs-toggle=\"modal\"\r\n                data-bs-target=\"#firmaModal\"\r\n                :disabled=\"isLoading\"\r\n            >\r\n              <i class=\"fas fa-sync-alt me-1\"></i>Actualizar firma\r\n            </button>\r\n          </div>\r\n        </div>\r\n\r\n        <!-- Body del Card -->\r\n        <div class=\"card-body\">\r\n          <p class=\"card-text text-muted mb-3\">\r\n            Aquí podrás ver y editar tus datos personales como colaborador de la UAF\r\n          </p>\r\n\r\n          <!-- Indicador de firma registrada -->\r\n          <div v-if=\"user.firma_path\" class=\"alert alert-success d-flex align-items-center mb-4\">\r\n            <i class=\"fas fa-check-circle me-2\"></i>\r\n            <span>Firma digital registrada correctamente</span>\r\n            <a\r\n                v-if=\"user.firma_url\"\r\n                :href=\"user.firma_url\"\r\n                target=\"_blank\"\r\n                class=\"btn btn-sm btn-outline-success ms-auto\"\r\n            >\r\n              <i class=\"fas fa-eye me-1\"></i>Ver firma\r\n            </a>\r\n          </div>\r\n\r\n          <!-- Loading indicator -->\r\n          <div v-if=\"isLoading\" class=\"text-center my-4\">\r\n            <div class=\"spinner-border text-primary\" role=\"status\">\r\n              <span class=\"visually-hidden\">Cargando...</span>\r\n            </div>\r\n            <p class=\"mt-2 text-muted\">Cargando datos del usuario...</p>\r\n          </div>\r\n\r\n          <!-- Formulario de datos -->\r\n          <form v-else class=\"pb-4 pt-2\">\r\n            <div class=\"row\">\r\n              <div class=\"col-md-4 mb-3\">\r\n                <label for=\"nombre\" class=\"form-label fw-semibold\">Nombre completo</label>\r\n                <input\r\n                    type=\"text\"\r\n                    class=\"form-control\"\r\n                    id=\"nombre\"\r\n                    v-model=\"user.nombre\"\r\n                    disabled\r\n                    placeholder=\"Nombre no disponible\"\r\n                >\r\n              </div>\r\n\r\n              <div class=\"col-md-4 mb-3\">\r\n                <label for=\"correo_electronico\" class=\"form-label fw-semibold\">Correo Electrónico</label>\r\n                <input\r\n                    type=\"email\"\r\n                    class=\"form-control\"\r\n                    id=\"correo_electronico\"\r\n                    v-model=\"user.correo_electronico\"\r\n                    disabled\r\n                    placeholder=\"Correo no disponible\"\r\n                >\r\n              </div>\r\n\r\n              <div class=\"col-md-4 mb-3\">\r\n                <label for=\"cargo\" class=\"form-label fw-semibold\">Cargo</label>\r\n                <input\r\n                    type=\"text\"\r\n                    class=\"form-control\"\r\n                    id=\"cargo\"\r\n                    v-model=\"user.cargo\"\r\n                    disabled\r\n                    placeholder=\"Cargo no asignado\"\r\n                >\r\n              </div>\r\n\r\n              <div class=\"col-md-4 mb-3\">\r\n                <label for=\"posicion\" class=\"form-label fw-semibold\">Posición</label>\r\n                <input\r\n                    type=\"text\"\r\n                    class=\"form-control\"\r\n                    id=\"posicion\"\r\n                    v-model=\"user.posicion\"\r\n                    disabled\r\n                    placeholder=\"Posición no asignada\"\r\n                >\r\n              </div>\r\n\r\n              <div class=\"col-md-4 mb-3\">\r\n                <label for=\"cedula\" class=\"form-label fw-semibold\">Cédula</label>\r\n                <input\r\n                    type=\"text\"\r\n                    class=\"form-control\"\r\n                    id=\"cedula\"\r\n                    v-model=\"user.cedula\"\r\n                    disabled\r\n                    placeholder=\"Cédula no registrada\"\r\n                >\r\n              </div>\r\n\r\n              <div class=\"col-md-4 mb-3\">\r\n                <label for=\"extension\" class=\"form-label fw-semibold\">Extensión telefónica</label>\r\n                <input\r\n                    type=\"text\"\r\n                    class=\"form-control\"\r\n                    id=\"extension\"\r\n                    v-model=\"user.extension\"\r\n                    disabled\r\n                    placeholder=\"Sin extensión\"\r\n                >\r\n              </div>\r\n\r\n              <div class=\"col-md-4 mb-3\">\r\n                <label for=\"estado\" class=\"form-label fw-semibold\">Estado</label>\r\n                <input\r\n                    type=\"text\"\r\n                    class=\"form-control\"\r\n                    id=\"estado\"\r\n                    v-model=\"user.estado\"\r\n                    disabled\r\n                    :class=\"{'text-success': user.estado === 'activo', 'text-danger': user.estado === 'inactivo'}\"\r\n                >\r\n              </div>\r\n\r\n              <div class=\"col-md-4 mb-3\">\r\n                <label for=\"departamento\" class=\"form-label fw-semibold\">Departamento</label>\r\n                <input\r\n                    type=\"text\"\r\n                    class=\"form-control\"\r\n                    id=\"departamento\"\r\n                    v-model=\"user.departamento\"\r\n                    disabled\r\n                    placeholder=\"Sin departamento asignado\"\r\n                >\r\n              </div>\r\n\r\n              <div class=\"col-md-4 mb-3\">\r\n                <label for=\"horas_extra\" class=\"form-label fw-semibold\">Tiempo extra (horas)</label>\r\n                <input\r\n                    type=\"text\"\r\n                    class=\"form-control\"\r\n                    id=\"horas_extra\"\r\n                    v-model=\"user.tiempo_extra\"\r\n                    disabled\r\n                    placeholder=\"0 horas\"\r\n                >\r\n              </div>\r\n            </div>\r\n          </form>\r\n        </div>\r\n      </div>\r\n    </div>\r\n\r\n    <!-- Modal editar usuario -->\r\n    <div class=\"modal fade\" id=\"editModal\" tabindex=\"-1\" aria-labelledby=\"editModalLabel\" aria-hidden=\"true\">\r\n      <div class=\"modal-dialog modal-lg\">\r\n        <div class=\"modal-content\">\r\n          <div class=\"modal-header\">\r\n            <h5 class=\"modal-title\" id=\"editModalLabel\">\r\n              <i class=\"fas fa-user-edit me-2\"></i>Editar Datos Personales\r\n            </h5>\r\n            <button type=\"button\" class=\"btn-close\" data-bs-dismiss=\"modal\" aria-label=\"Close\"></button>\r\n          </div>\r\n\r\n          <div class=\"modal-body\">\r\n            <form @submit.prevent=\"updateUserData\">\r\n              <div class=\"row\">\r\n                <div class=\"col-md-6 mb-3\">\r\n                  <label for=\"editNombre\" class=\"form-label fw-semibold\">\r\n                    Nombre completo <span class=\"text-danger\">*</span>\r\n                  </label>\r\n                  <input\r\n                      type=\"text\"\r\n                      class=\"form-control\"\r\n                      id=\"editNombre\"\r\n                      v-model=\"editUser.nombre\"\r\n                      :class=\"{'is-invalid': editErrors.nombre}\"\r\n                      required\r\n                  >\r\n                  <div v-if=\"editErrors.nombre\" class=\"invalid-feedback\">\r\n                    {{ editErrors.nombre[0] }}\r\n                  </div>\r\n                </div>\r\n\r\n                <div class=\"col-md-6 mb-3\">\r\n                  <label for=\"editCargo\" class=\"form-label fw-semibold\">\r\n                    Cargo <span class=\"text-danger\">*</span>\r\n                  </label>\r\n                  <input\r\n                      type=\"text\"\r\n                      class=\"form-control\"\r\n                      id=\"editCargo\"\r\n                      v-model=\"editUser.cargo\"\r\n                      :class=\"{'is-invalid': editErrors.cargo}\"\r\n                      required\r\n                  >\r\n                  <div v-if=\"editErrors.cargo\" class=\"invalid-feedback\">\r\n                    {{ editErrors.cargo[0] }}\r\n                  </div>\r\n                </div>\r\n\r\n                <div class=\"col-md-6 mb-3\">\r\n                  <label for=\"editPosicion\" class=\"form-label fw-semibold\">\r\n                    Posición <span class=\"text-danger\">*</span>\r\n                  </label>\r\n                  <input\r\n                      type=\"text\"\r\n                      class=\"form-control\"\r\n                      id=\"editPosicion\"\r\n                      v-model=\"editUser.posicion\"\r\n                      :class=\"{'is-invalid': editErrors.posicion}\"\r\n                      required\r\n                  >\r\n                  <div v-if=\"editErrors.posicion\" class=\"invalid-feedback\">\r\n                    {{ editErrors.posicion[0] }}\r\n                  </div>\r\n                </div>\r\n\r\n                <div class=\"col-md-6 mb-3\">\r\n                  <label for=\"editExtension\" class=\"form-label fw-semibold\">\r\n                    Extensión telefónica <span class=\"text-danger\">*</span>\r\n                  </label>\r\n                  <input\r\n                      type=\"text\"\r\n                      class=\"form-control\"\r\n                      id=\"editExtension\"\r\n                      v-model=\"editUser.extension\"\r\n                      :class=\"{'is-invalid': editErrors.extension}\"\r\n                      required\r\n                  >\r\n                  <div v-if=\"editErrors.extension\" class=\"invalid-feedback\">\r\n                    {{ editErrors.extension[0] }}\r\n                  </div>\r\n                </div>\r\n              </div>\r\n\r\n              <div class=\"mb-3\">\r\n                <label for=\"editFirma\" class=\"form-label fw-semibold\">\r\n                  Actualizar firma digital (opcional)\r\n                </label>\r\n                <input\r\n                    type=\"file\"\r\n                    class=\"form-control\"\r\n                    id=\"editFirma\"\r\n                    accept=\"image/png,image/jpeg,image/jpg\"\r\n                    @change=\"handleEditFirmaFile\"\r\n                />\r\n                <small class=\"form-text text-muted\">\r\n                  Selecciona un archivo solo si deseas cambiar tu firma actual. Formatos: PNG, JPG, JPEG (máx. 2MB)\r\n                </small>\r\n              </div>\r\n\r\n              <div class=\"d-flex justify-content-end gap-2\">\r\n                <button type=\"button\" class=\"btn btn-secondary\" data-bs-dismiss=\"modal\">\r\n                  <i class=\"fas fa-times me-1\"></i>Cancelar\r\n                </button>\r\n                <button type=\"submit\" class=\"btn btn-primary\" :disabled=\"isUpdating\">\r\n                  <span v-if=\"isUpdating\" class=\"spinner-border spinner-border-sm me-2\" role=\"status\"></span>\r\n                  <i v-else class=\"fas fa-save me-1\"></i>\r\n                  {{ isUpdating ? 'Guardando...' : 'Guardar cambios' }}\r\n                </button>\r\n              </div>\r\n            </form>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n\r\n    <!-- Modal subir/actualizar firma -->\r\n    <div class=\"modal fade\" id=\"firmaModal\" tabindex=\"-1\" aria-labelledby=\"firmaModalLabel\" aria-hidden=\"true\">\r\n      <div class=\"modal-dialog\">\r\n        <div class=\"modal-content\">\r\n          <form @submit.prevent=\"uploadFirma\">\r\n            <div class=\"modal-header\">\r\n              <h5 class=\"modal-title\" id=\"firmaModalLabel\">\r\n                <i class=\"fas fa-signature me-2\"></i>\r\n                {{ user.firma_path ? 'Actualizar Firma Digital' : 'Registrar Firma Digital' }}\r\n              </h5>\r\n              <button type=\"button\" class=\"btn-close\" data-bs-dismiss=\"modal\" aria-label=\"Close\"></button>\r\n            </div>\r\n\r\n            <div class=\"modal-body\">\r\n              <div class=\"mb-3\">\r\n                <label for=\"firmaInput\" class=\"form-label fw-semibold\">\r\n                  Seleccionar archivo de imagen <span class=\"text-danger\">*</span>\r\n                </label>\r\n                <input\r\n                    type=\"file\"\r\n                    id=\"firmaInput\"\r\n                    class=\"form-control\"\r\n                    accept=\"image/png,image/jpeg,image/jpg\"\r\n                    @change=\"handleFirmaFile\"\r\n                    required\r\n                    :disabled=\"isUploading\"\r\n                />\r\n                <small class=\"form-text text-muted\">\r\n                  Formatos soportados: PNG, JPG, JPEG. Tamaño máximo: 2MB\r\n                </small>\r\n              </div>\r\n\r\n              <!-- Preview de la imagen seleccionada -->\r\n              <div v-if=\"firmaPreview\" class=\"mb-3\">\r\n                <label class=\"form-label fw-semibold\">Vista previa:</label>\r\n                <div class=\"border rounded p-3 text-center bg-light\">\r\n                  <img\r\n                      :src=\"firmaPreview\"\r\n                      alt=\"Preview de firma\"\r\n                      class=\"img-fluid shadow-sm\"\r\n                      style=\"max-height: 200px; border-radius: 8px;\"\r\n                  >\r\n                </div>\r\n              </div>\r\n\r\n              <!-- Información adicional -->\r\n              <div class=\"alert alert-info\">\r\n                <i class=\"fas fa-info-circle me-2\"></i>\r\n                <small>\r\n                  La firma será procesada automáticamente para eliminar fondos blancos y optimizar su uso en documentos.\r\n                </small>\r\n              </div>\r\n            </div>\r\n\r\n            <div class=\"modal-footer\">\r\n              <button type=\"button\" class=\"btn btn-secondary\" data-bs-dismiss=\"modal\" :disabled=\"isUploading\">\r\n                <i class=\"fas fa-times me-1\"></i>Cancelar\r\n              </button>\r\n              <button type=\"submit\" class=\"btn btn-success\" :disabled=\"!firmaFile || isUploading\">\r\n                <span v-if=\"isUploading\" class=\"spinner-border spinner-border-sm me-2\" role=\"status\"></span>\r\n                <i v-else class=\"fas fa-upload me-1\"></i>\r\n                {{ isUploading ? 'Subiendo...' : (user.firma_path ? 'Actualizar Firma' : 'Subir Firma') }}\r\n              </button>\r\n            </div>\r\n          </form>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport axios from 'axios'\r\nimport { Modal } from 'bootstrap'\r\nimport Swal from 'sweetalert2'\r\n\r\nexport default {\r\n  name: 'DatosUsuario',\r\n\r\n  // CAMBIO: Async setup para pre-cargar datos\r\n  async setup() {\r\n    const userData = await fetchUserData()\r\n    return {\r\n      initialUserData: userData\r\n    }\r\n  },\r\n\r\n  data() {\r\n    return {\r\n      // Datos del usuario - inicializados con datos async\r\n      user: this.initialUserData || {\r\n        id: null,\r\n        nombre: '',\r\n        correo_electronico: '',\r\n        cargo: '',\r\n        posicion: '',\r\n        cedula: '',\r\n        extension: '',\r\n        estado: '',\r\n        departamento: '',\r\n        tiempo_extra: '',\r\n        firma_path: null,\r\n        firma_url: null\r\n      },\r\n\r\n      // Datos para edición\r\n      editUser: {\r\n        nombre: '',\r\n        cargo: '',\r\n        posicion: '',\r\n        extension: ''\r\n      },\r\n\r\n      // Archivos de firma\r\n      firmaFile: null,\r\n      editFirmaFile: null,\r\n      firmaPreview: null,\r\n\r\n      // Instancias de modales\r\n      editModalInstance: null,\r\n      firmaModalInstance: null,\r\n\r\n      // Estados de carga\r\n      isLoading: false,\r\n      isUpdating: false,\r\n      isUploading: false,\r\n\r\n      // Errores de validación\r\n      editErrors: {}\r\n    }\r\n  },\r\n\r\n  mounted() {\r\n    // Inicializar datos de edición\r\n    this.editUser = {\r\n      nombre: this.user.nombre || '',\r\n      cargo: this.user.cargo || '',\r\n      posicion: this.user.posicion || '',\r\n      extension: this.user.extension || ''\r\n    }\r\n\r\n    // Inicializar modales\r\n    this.$nextTick(() => {\r\n      this.editModalInstance = new Modal(document.getElementById('editModal'))\r\n      this.firmaModalInstance = new Modal(document.getElementById('firmaModal'))\r\n    })\r\n  },\r\n\r\n  methods: {\r\n    /**\r\n     * Obtener datos del usuario autenticado\r\n     */\r\n    async fetchUserData() {\r\n      this.isLoading = true\r\n      try {\r\n        const token = localStorage.getItem('auth_token')\r\n        if (!token) {\r\n          this.$router.push('/login')\r\n          return\r\n        }\r\n\r\n        const response = await axios.get('http://localhost:8000/api/information_user', {\r\n          headers: {\r\n            'Authorization': `Bearer ${token}`\r\n          }\r\n        })\r\n\r\n        if (response.data.status) {\r\n          this.user = response.data.data\r\n          this.editUser = {\r\n            nombre: this.user.nombre || '',\r\n            cargo: this.user.cargo || '',\r\n            posicion: this.user.posicion || '',\r\n            extension: this.user.extension || ''\r\n          }\r\n        } else {\r\n          throw new Error(response.data.message || 'Error al obtener datos')\r\n        }\r\n\r\n        this.$nextTick(() => {\r\n          this.editModalInstance = new Modal(document.getElementById('editModal'))\r\n          this.firmaModalInstance = new Modal(document.getElementById('firmaModal'))\r\n        })\r\n\r\n      } catch (error) {\r\n        console.error('Error al cargar datos del usuario:', error)\r\n\r\n        if (error.response?.status === 401) {\r\n          localStorage.removeItem('auth_token')\r\n          this.$router.push('/login')\r\n          return\r\n        }\r\n\r\n        Swal.fire({\r\n          icon: 'error',\r\n          title: 'Error',\r\n          text: error.response?.data?.message || 'Error al cargar sus datos'\r\n        })\r\n      } finally {\r\n        this.isLoading = false\r\n      }\r\n    },\r\n\r\n    /**\r\n     * Actualizar datos básicos del usuario\r\n     */\r\n    async updateUserData() {\r\n      this.isUpdating = true\r\n      this.editErrors = {}\r\n\r\n      try {\r\n        const token = localStorage.getItem('auth_token')\r\n\r\n        // Actualizar datos básicos del usuario\r\n        const updateResponse = await axios.put('http://localhost:8000/api/edit_information', this.editUser, {\r\n          headers: {\r\n            'Authorization': `Bearer ${token}`\r\n          }\r\n        })\r\n\r\n        if (!updateResponse.data.status) {\r\n          throw new Error(updateResponse.data.message || 'Error al actualizar datos')\r\n        }\r\n\r\n        // Si hay una nueva firma, subirla\r\n        if (this.editFirmaFile) {\r\n          const formData = new FormData()\r\n          formData.append('firma', this.editFirmaFile)\r\n\r\n          const firmaResponse = await axios.post('http://localhost:8000/api/upload-firma', formData, {\r\n            headers: {\r\n              'Authorization': `Bearer ${token}`,\r\n              'Content-Type': 'multipart/form-data'\r\n            }\r\n          })\r\n\r\n          if (firmaResponse.data.success && firmaResponse.data.data?.user) {\r\n            // Actualizar datos del usuario con la nueva firma\r\n            Object.assign(this.user, firmaResponse.data.data.user)\r\n          }\r\n        }\r\n\r\n        // Actualizar datos locales\r\n        Object.assign(this.user, this.editUser)\r\n\r\n        // Cerrar modal de forma más robusta\r\n        this.closeModal('editModal')\r\n        this.resetEditForm()\r\n\r\n        // Mostrar mensaje de éxito\r\n        await Swal.fire({\r\n          icon: 'success',\r\n          title: 'Datos actualizados',\r\n          text: 'Los datos se han actualizado correctamente',\r\n          timer: 2000,\r\n          showConfirmButton: false,\r\n          allowOutsideClick: true,\r\n          allowEscapeKey: true\r\n        })\r\n\r\n        // Recargar datos para asegurar sincronización\r\n        await this.fetchUserData()\r\n\r\n      } catch (error) {\r\n        console.error('Error al actualizar datos:', error)\r\n\r\n        if (error.response?.status === 422) {\r\n          this.editErrors = error.response.data.errors || {}\r\n        }\r\n\r\n        await Swal.fire({\r\n          icon: 'error',\r\n          title: 'Error',\r\n          text: error.response?.data?.message || 'Ha ocurrido un error al actualizar los datos',\r\n          allowOutsideClick: true,\r\n          allowEscapeKey: true\r\n        })\r\n      } finally {\r\n        this.isUpdating = false\r\n        // Asegurar que no queden modales abiertos\r\n        this.removeModalBackdrops()\r\n      }\r\n    },\r\n\r\n    /**\r\n     * Manejar selección de archivo de firma (modal principal)\r\n     */\r\n    handleFirmaFile(e) {\r\n      const file = e.target.files[0]\r\n      if (file) {\r\n        // Validar tamaño (2MB)\r\n        if (file.size > 2 * 1024 * 1024) {\r\n          Swal.fire({\r\n            icon: 'warning',\r\n            title: 'Archivo muy grande',\r\n            text: 'El archivo debe ser menor a 2MB'\r\n          })\r\n          e.target.value = ''\r\n          return\r\n        }\r\n\r\n        this.firmaFile = file\r\n\r\n        // Crear preview de la imagen\r\n        const reader = new FileReader()\r\n        reader.onload = (event) => {\r\n          this.firmaPreview = event.target.result\r\n        }\r\n        reader.readAsDataURL(file)\r\n      } else {\r\n        this.firmaFile = null\r\n        this.firmaPreview = null\r\n      }\r\n    },\r\n\r\n    /**\r\n     * Manejar selección de archivo de firma (modal de edición)\r\n     */\r\n    handleEditFirmaFile(e) {\r\n      const file = e.target.files[0]\r\n      if (file && file.size > 2 * 1024 * 1024) {\r\n        Swal.fire({\r\n          icon: 'warning',\r\n          title: 'Archivo muy grande',\r\n          text: 'El archivo debe ser menor a 2MB'\r\n        })\r\n        e.target.value = ''\r\n        return\r\n      }\r\n      this.editFirmaFile = file\r\n    },\r\n\r\n    /**\r\n     * Subir firma digital\r\n     */\r\n    async uploadFirma() {\r\n      if (!this.firmaFile) {\r\n        Swal.fire({\r\n          icon: 'warning',\r\n          title: 'Atención',\r\n          text: 'Por favor selecciona un archivo de imagen'\r\n        })\r\n        return\r\n      }\r\n\r\n      this.isUploading = true\r\n      const formData = new FormData()\r\n      formData.append('firma', this.firmaFile)\r\n\r\n      try {\r\n        const token = localStorage.getItem('auth_token')\r\n        const response = await axios.post('http://localhost:8000/api/upload-firma', formData, {\r\n          headers: {\r\n            'Authorization': `Bearer ${token}`,\r\n            'Content-Type': 'multipart/form-data'\r\n          }\r\n        })\r\n\r\n        console.log('Respuesta del servidor:', response.data)\r\n\r\n        // Actualizar el usuario con la nueva firma\r\n        if (response.data.success && response.data.data) {\r\n          if (response.data.data.user) {\r\n            // Actualizar con los datos completos del usuario desde el servidor\r\n            Object.assign(this.user, response.data.data.user)\r\n          } else if (response.data.data.firma_path) {\r\n            // Actualizar solo la firma\r\n            this.user.firma_path = response.data.data.firma_path\r\n            this.user.firma_url = response.data.data.firma_url\r\n          }\r\n        }\r\n\r\n        // Cerrar modal de forma más robusta\r\n        this.closeModal('firmaModal')\r\n        this.resetFirmaForm()\r\n\r\n        // Mostrar mensaje de éxito\r\n        await Swal.fire({\r\n          icon: 'success',\r\n          title: this.user.firma_path ? 'Firma actualizada' : 'Firma registrada',\r\n          text: 'Tu firma se ha guardado correctamente',\r\n          timer: 2000,\r\n          showConfirmButton: false,\r\n          allowOutsideClick: true,\r\n          allowEscapeKey: true\r\n        })\r\n\r\n        // Recargar datos para asegurar sincronización\r\n        await this.fetchUserData()\r\n\r\n      } catch (error) {\r\n        console.error('Error al subir firma:', error)\r\n\r\n        let errorMessage = 'Error al subir la firma'\r\n\r\n        if (error.response?.data?.message) {\r\n          errorMessage = error.response.data.message\r\n        } else if (error.response?.data?.errors) {\r\n          const errors = Object.values(error.response.data.errors).flat()\r\n          errorMessage = errors.join(', ')\r\n        }\r\n\r\n        await Swal.fire({\r\n          icon: 'error',\r\n          title: 'Error',\r\n          text: errorMessage,\r\n          allowOutsideClick: true,\r\n          allowEscapeKey: true\r\n        })\r\n      } finally {\r\n        this.isUploading = false\r\n        // Asegurar que no queden modales abiertos\r\n        this.removeModalBackdrops()\r\n      }\r\n    },\r\n\r\n    /**\r\n     * Resetear formulario de firma\r\n     */\r\n    resetFirmaForm() {\r\n      this.firmaFile = null\r\n      this.firmaPreview = null\r\n      const input = document.getElementById('firmaInput')\r\n      if (input) input.value = ''\r\n    },\r\n\r\n    /**\r\n     * Resetear formulario de edición\r\n     */\r\n    resetEditForm() {\r\n      this.editFirmaFile = null\r\n      this.editErrors = {}\r\n      const editFirmaInput = document.getElementById('editFirma')\r\n      if (editFirmaInput) editFirmaInput.value = ''\r\n    },\r\n\r\n    /**\r\n     * Cerrar modal de forma más robusta\r\n     */\r\n    closeModal(modalId) {\r\n      try {\r\n        const modalElement = document.getElementById(modalId)\r\n        if (modalElement) {\r\n          const modalInstance = Modal.getInstance(modalElement)\r\n          if (modalInstance) {\r\n            modalInstance.hide()\r\n          }\r\n\r\n          // Forzar el cierre del modal\r\n          modalElement.classList.remove('show')\r\n          modalElement.style.display = 'none'\r\n          modalElement.setAttribute('aria-hidden', 'true')\r\n          modalElement.removeAttribute('aria-modal')\r\n          modalElement.removeAttribute('role')\r\n        }\r\n\r\n        // Remover backdrops que puedan haber quedado\r\n        this.removeModalBackdrops()\r\n\r\n        // Restaurar el scroll del body\r\n        document.body.classList.remove('modal-open')\r\n        document.body.style.overflow = ''\r\n        document.body.style.paddingRight = ''\r\n\r\n      } catch (error) {\r\n        console.error('Error al cerrar modal:', error)\r\n        // Método de emergencia - forzar limpieza\r\n        this.forceCloseAllModals()\r\n      }\r\n    },\r\n\r\n    /**\r\n     * Remover todos los backdrops de modales\r\n     */\r\n    removeModalBackdrops() {\r\n      const backdrops = document.querySelectorAll('.modal-backdrop')\r\n      backdrops.forEach(backdrop => {\r\n        backdrop.remove()\r\n      })\r\n    },\r\n\r\n    /**\r\n     * Método de emergencia para cerrar todos los modales\r\n     */\r\n    forceCloseAllModals() {\r\n      // Remover todas las clases y elementos relacionados con modales\r\n      document.body.classList.remove('modal-open')\r\n      document.body.style.overflow = ''\r\n      document.body.style.paddingRight = ''\r\n\r\n      // Cerrar todos los modales\r\n      const modals = document.querySelectorAll('.modal')\r\n      modals.forEach(modal => {\r\n        modal.classList.remove('show')\r\n        modal.style.display = 'none'\r\n        modal.setAttribute('aria-hidden', 'true')\r\n        modal.removeAttribute('aria-modal')\r\n        modal.removeAttribute('role')\r\n      })\r\n\r\n      // Remover todos los backdrops\r\n      this.removeModalBackdrops()\r\n    }\r\n  }\r\n}\r\n\r\n// FUNCIÓN AUXILIAR ASYNC - Para pre-cargar datos\r\nasync function fetchUserData() {\r\n  try {\r\n    const token = localStorage.getItem('auth_token')\r\n    if (!token) {\r\n      // La redirección será manejada por el router guard o el componente padre\r\n      throw new Error('No token found')\r\n    }\r\n\r\n    const response = await axios.get('http://localhost:8000/api/information_user', {\r\n      headers: {\r\n        'Authorization': `Bearer ${token}`\r\n      }\r\n    })\r\n\r\n    if (response.data.status) {\r\n      return response.data.data\r\n    } else {\r\n      throw new Error(response.data.message || 'Error al obtener datos')\r\n    }\r\n\r\n  } catch (error) {\r\n    console.error('Error al cargar datos del usuario:', error)\r\n\r\n    if (error.response?.status === 401) {\r\n      localStorage.removeItem('auth_token')\r\n      // El router o componente padre manejará la redirección\r\n    }\r\n\r\n    // Retornar datos por defecto para evitar errores\r\n    return {\r\n      id: null,\r\n      nombre: '',\r\n      correo_electronico: '',\r\n      cargo: '',\r\n      posicion: '',\r\n      cedula: '',\r\n      extension: '',\r\n      estado: '',\r\n      departamento: '',\r\n      tiempo_extra: '',\r\n      firma_path: null,\r\n      firma_url: null\r\n    }\r\n  }\r\n}\r\n</script>\r\n\r\n<style scoped>\r\n.spinner-border-sm {\r\n  width: 1rem;\r\n  height: 1rem;\r\n}\r\n\r\n.alert {\r\n  border-radius: 0.5rem;\r\n}\r\n\r\n.img-fluid {\r\n  border-radius: 0.375rem;\r\n}\r\n\r\n.card {\r\n  border: none;\r\n  box-shadow: 0 0.125rem 0.25rem rgba(0, 0, 0, 0.075);\r\n}\r\n\r\n.card-header {\r\n  background-color: #f8f9fa;\r\n  border-bottom: 1px solid #dee2e6;\r\n}\r\n\r\n.form-label {\r\n  color: #495057;\r\n  margin-bottom: 0.5rem;\r\n}\r\n\r\n.form-control:disabled {\r\n  background-color: #f8f9fa;\r\n  border-color: #e9ecef;\r\n}\r\n\r\n.btn-group .btn {\r\n  border-radius: 0.375rem;\r\n}\r\n\r\n.btn-group .btn:not(:last-child) {\r\n  margin-right: 0.5rem;\r\n}\r\n\r\n.modal-content {\r\n  border: none;\r\n  box-shadow: 0 0.5rem 1rem rgba(0, 0, 0, 0.15);\r\n}\r\n\r\n.modal-header {\r\n  border-bottom: 1px solid #dee2e6;\r\n  background-color: #f8f9fa;\r\n}\r\n\r\n.modal-footer {\r\n  border-top: 1px solid #dee2e6;\r\n  background-color: #f8f9fa;\r\n}\r\n\r\n.text-success {\r\n  color: #198754 !important;\r\n}\r\n\r\n.text-danger {\r\n  color: #dc3545 !important;\r\n}\r\n\r\n.fw-semibold {\r\n  font-weight: 600;\r\n}\r\n\r\n.gap-2 {\r\n  gap: 0.5rem;\r\n}\r\n\r\n</style>"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}