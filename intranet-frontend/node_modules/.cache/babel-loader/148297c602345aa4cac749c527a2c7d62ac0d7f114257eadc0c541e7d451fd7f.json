{"ast":null,"code":"import { mapGetters, mapActions } from 'vuex';\nimport { Modal } from 'bootstrap';\nimport Swal from 'sweetalert2';\nimport axios from 'axios';\nexport default {\n  name: 'DatosUsuario',\n  computed: {\n    ...mapGetters(['userProfile', 'isLoading']),\n    // Usar datos de Vuex como fuente principal\n    user() {\n      return this.userProfile || {\n        id: null,\n        nombre: '',\n        correo_electronico: '',\n        cargo: '',\n        posicion: '',\n        cedula: '',\n        extension: '',\n        estado: '',\n        departamento: '',\n        tiempo_extra: '',\n        firma_path: null,\n        firma_url: null\n      };\n    },\n    // Estado de loading desde Vuex - CORREGIDO\n    isLoadingUser() {\n      return this.$store.getters.isLoading('userProfile');\n    }\n  },\n  data() {\n    return {\n      // Datos para edición\n      editUser: {\n        nombre: '',\n        cargo: '',\n        posicion: '',\n        extension: ''\n      },\n      // Archivos de firma\n      firmaFile: null,\n      editFirmaFile: null,\n      firmaPreview: null,\n      // Instancias de modales\n      editModalInstance: null,\n      firmaModalInstance: null,\n      // Estados de carga locales\n      isUpdating: false,\n      isUploading: false,\n      // Errores de validación\n      editErrors: {}\n    };\n  },\n  watch: {\n    // Reactivo a cambios en el perfil de usuario desde Vuex\n    user: {\n      handler(newUser) {\n        if (newUser && newUser.nombre) {\n          // VALIDACIÓN AGREGADA\n          this.updateEditUserData(newUser);\n        }\n      },\n      immediate: true,\n      deep: true // AGREGADO para detectar cambios profundos\n    }\n  },\n  mounted() {\n    // Si no tenemos datos en Vuex, intentar cargarlos\n    if (!this.userProfile) {\n      this.fetchUserProfile().catch(error => {\n        console.error('Error loading user profile:', error);\n      });\n    }\n\n    // Inicializar modales con delay para asegurar que el DOM esté listo\n    this.$nextTick(() => {\n      setTimeout(() => {\n        this.initializeModals();\n      }, 100); // Pequeño delay para asegurar que el DOM esté completamente renderizado\n    });\n  },\n  // AGREGADO: Cleanup al desmontar componente\n  beforeUnmount() {\n    this.cleanupModals();\n  },\n  methods: {\n    ...mapActions(['fetchUserProfile', 'refreshUserProfile']),\n    // Actualizar datos de edición basados en el usuario\n    updateEditUserData(user) {\n      if (!user) return; // VALIDACIÓN AGREGADA\n\n      this.editUser = {\n        nombre: user.nombre || '',\n        cargo: user.cargo || '',\n        posicion: user.posicion || '',\n        extension: user.extension || ''\n      };\n    },\n    // Inicializar modales con validaciones\n    initializeModals() {\n      try {\n        const editModalEl = document.getElementById('editModal');\n        const firmaModalEl = document.getElementById('firmaModal');\n\n        // VALIDACIÓN: Solo inicializar si los elementos existen\n        if (editModalEl && !this.editModalInstance) {\n          this.editModalInstance = new Modal(editModalEl);\n        }\n        if (firmaModalEl && !this.firmaModalInstance) {\n          this.firmaModalInstance = new Modal(firmaModalEl);\n        }\n      } catch (error) {\n        console.error('Error inicializando modales:', error);\n        // Reintentar después de un segundo\n        setTimeout(() => {\n          this.initializeModals();\n        }, 1000);\n      }\n    },\n    // NUEVO: Cleanup de modales\n    cleanupModals() {\n      try {\n        if (this.editModalInstance) {\n          this.editModalInstance.dispose();\n          this.editModalInstance = null;\n        }\n        if (this.firmaModalInstance) {\n          this.firmaModalInstance.dispose();\n          this.firmaModalInstance = null;\n        }\n      } catch (error) {\n        console.error('Error limpiando modales:', error);\n      }\n    },\n    /**\r\n     * Actualizar datos básicos del usuario\r\n     */\n    async updateUserData() {\n      this.isUpdating = true;\n      this.editErrors = {};\n      try {\n        const token = localStorage.getItem('auth_token');\n\n        // Actualizar datos básicos del usuario\n        const updateResponse = await axios.put('http://localhost:8000/api/edit_information', this.editUser, {\n          headers: {\n            'Authorization': `Bearer ${token}`\n          }\n        });\n        if (!updateResponse.data.status) {\n          throw new Error(updateResponse.data.message || 'Error al actualizar datos');\n        }\n\n        // Si hay una nueva firma, subirla\n        if (this.editFirmaFile) {\n          const formData = new FormData();\n          formData.append('firma', this.editFirmaFile);\n          await axios.post('http://localhost:8000/api/upload-firma', formData, {\n            headers: {\n              'Authorization': `Bearer ${token}`,\n              'Content-Type': 'multipart/form-data'\n            }\n          });\n        }\n\n        // Cerrar modal\n        this.closeModal('editModal');\n        this.resetEditForm();\n\n        // Mostrar mensaje de éxito\n        await Swal.fire({\n          icon: 'success',\n          title: 'Datos actualizados',\n          text: 'Los datos se han actualizado correctamente',\n          timer: 2000,\n          showConfirmButton: false,\n          allowOutsideClick: true,\n          allowEscapeKey: true\n        });\n\n        // Refrescar datos en Vuex\n        await this.refreshUserProfile();\n      } catch (error) {\n        console.error('Error al actualizar datos:', error);\n        if (error.response?.status === 422) {\n          this.editErrors = error.response.data.errors || {};\n        }\n        await Swal.fire({\n          icon: 'error',\n          title: 'Error',\n          text: error.response?.data?.message || 'Ha ocurrido un error al actualizar los datos',\n          allowOutsideClick: true,\n          allowEscapeKey: true\n        });\n      } finally {\n        this.isUpdating = false;\n        // Limpiar backdrops que puedan haber quedado\n        this.removeModalBackdrops();\n      }\n    },\n    /**\r\n     * Manejar selección de archivo de firma (modal principal)\r\n     */\n    handleFirmaFile(e) {\n      const file = e.target.files[0];\n      if (file) {\n        // Validar tamaño (2MB)\n        if (file.size > 2 * 1024 * 1024) {\n          Swal.fire({\n            icon: 'warning',\n            title: 'Archivo muy grande',\n            text: 'El archivo debe ser menor a 2MB'\n          });\n          e.target.value = '';\n          return;\n        }\n        this.firmaFile = file;\n\n        // Crear preview de la imagen\n        const reader = new FileReader();\n        reader.onload = event => {\n          this.firmaPreview = event.target.result;\n        };\n        reader.readAsDataURL(file);\n      } else {\n        this.firmaFile = null;\n        this.firmaPreview = null;\n      }\n    },\n    /**\r\n     * Manejar selección de archivo de firma (modal de edición)\r\n     */\n    handleEditFirmaFile(e) {\n      const file = e.target.files[0];\n      if (file && file.size > 2 * 1024 * 1024) {\n        Swal.fire({\n          icon: 'warning',\n          title: 'Archivo muy grande',\n          text: 'El archivo debe ser menor a 2MB'\n        });\n        e.target.value = '';\n        return;\n      }\n      this.editFirmaFile = file;\n    },\n    /**\r\n     * Subir firma digital\r\n     */\n    async uploadFirma() {\n      if (!this.firmaFile) {\n        Swal.fire({\n          icon: 'warning',\n          title: 'Atención',\n          text: 'Por favor selecciona un archivo de imagen'\n        });\n        return;\n      }\n      this.isUploading = true;\n      const formData = new FormData();\n      formData.append('firma', this.firmaFile);\n      try {\n        const token = localStorage.getItem('auth_token');\n        const response = await axios.post('http://localhost:8000/api/upload-firma', formData, {\n          headers: {\n            'Authorization': `Bearer ${token}`,\n            'Content-Type': 'multipart/form-data'\n          }\n        });\n\n        // Cerrar modal\n        this.closeModal('firmaModal');\n        this.resetFirmaForm();\n\n        // Mostrar mensaje de éxito\n        await Swal.fire({\n          icon: 'success',\n          title: this.user.firma_path ? 'Firma actualizada' : 'Firma registrada',\n          text: 'Tu firma se ha guardado correctamente',\n          timer: 2000,\n          showConfirmButton: false,\n          allowOutsideClick: true,\n          allowEscapeKey: true\n        });\n\n        // Refrescar datos en Vuex\n        await this.refreshUserProfile();\n      } catch (error) {\n        console.error('Error al subir firma:', error);\n        let errorMessage = 'Error al subir la firma';\n        if (error.response?.data?.message) {\n          errorMessage = error.response.data.message;\n        } else if (error.response?.data?.errors) {\n          const errors = Object.values(error.response.data.errors).flat();\n          errorMessage = errors.join(', ');\n        }\n        await Swal.fire({\n          icon: 'error',\n          title: 'Error',\n          text: errorMessage,\n          allowOutsideClick: true,\n          allowEscapeKey: true\n        });\n      } finally {\n        this.isUploading = false;\n        this.removeModalBackdrops();\n      }\n    },\n    // Métodos de utilidad - MEJORADOS con validaciones\n    resetFirmaForm() {\n      this.firmaFile = null;\n      this.firmaPreview = null;\n      const input = document.getElementById('firmaInput');\n      if (input) input.value = '';\n    },\n    resetEditForm() {\n      this.editFirmaFile = null;\n      this.editErrors = {};\n      const editFirmaInput = document.getElementById('editFirma');\n      if (editFirmaInput) editFirmaInput.value = '';\n    },\n    closeModal(modalId) {\n      try {\n        const modalElement = document.getElementById(modalId);\n        if (!modalElement) {\n          console.warn(`Modal element ${modalId} not found`);\n          return;\n        }\n        const modalInstance = Modal.getInstance(modalElement);\n        if (modalInstance) {\n          modalInstance.hide();\n        }\n\n        // Método alternativo de cierre\n        modalElement.classList.remove('show');\n        modalElement.style.display = 'none';\n        modalElement.setAttribute('aria-hidden', 'true');\n        modalElement.removeAttribute('aria-modal');\n        modalElement.removeAttribute('role');\n\n        // Limpiar backdrops\n        this.removeModalBackdrops();\n\n        // Restaurar el scroll del body\n        document.body.classList.remove('modal-open');\n        document.body.style.overflow = '';\n        document.body.style.paddingRight = '';\n      } catch (error) {\n        console.error('Error al cerrar modal:', error);\n        // Método de emergencia\n        this.forceCloseAllModals();\n      }\n    },\n    removeModalBackdrops() {\n      try {\n        const backdrops = document.querySelectorAll('.modal-backdrop');\n        backdrops.forEach(backdrop => {\n          if (backdrop && backdrop.parentNode) {\n            // VALIDACIÓN AGREGADA\n            backdrop.remove();\n          }\n        });\n      } catch (error) {\n        console.error('Error removing backdrops:', error);\n      }\n    },\n    forceCloseAllModals() {\n      try {\n        // Remover todas las clases y elementos relacionados con modales\n        document.body.classList.remove('modal-open');\n        document.body.style.overflow = '';\n        document.body.style.paddingRight = '';\n\n        // Cerrar todos los modales\n        const modals = document.querySelectorAll('.modal');\n        modals.forEach(modal => {\n          if (modal) {\n            // VALIDACIÓN AGREGADA\n            modal.classList.remove('show');\n            modal.style.display = 'none';\n            modal.setAttribute('aria-hidden', 'true');\n            modal.removeAttribute('aria-modal');\n            modal.removeAttribute('role');\n          }\n        });\n\n        // Remover todos los backdrops\n        this.removeModalBackdrops();\n      } catch (error) {\n        console.error('Error in force close all modals:', error);\n      }\n    }\n  }\n};","map":{"version":3,"names":["mapGetters","mapActions","Modal","Swal","axios","name","computed","user","userProfile","id","nombre","correo_electronico","cargo","posicion","cedula","extension","estado","departamento","tiempo_extra","firma_path","firma_url","isLoadingUser","$store","getters","isLoading","data","editUser","firmaFile","editFirmaFile","firmaPreview","editModalInstance","firmaModalInstance","isUpdating","isUploading","editErrors","watch","handler","newUser","updateEditUserData","immediate","deep","mounted","fetchUserProfile","catch","error","console","$nextTick","setTimeout","initializeModals","beforeUnmount","cleanupModals","methods","editModalEl","document","getElementById","firmaModalEl","dispose","updateUserData","token","localStorage","getItem","updateResponse","put","headers","status","Error","message","formData","FormData","append","post","closeModal","resetEditForm","fire","icon","title","text","timer","showConfirmButton","allowOutsideClick","allowEscapeKey","refreshUserProfile","response","errors","removeModalBackdrops","handleFirmaFile","e","file","target","files","size","value","reader","FileReader","onload","event","result","readAsDataURL","handleEditFirmaFile","uploadFirma","resetFirmaForm","errorMessage","Object","values","flat","join","input","editFirmaInput","modalId","modalElement","warn","modalInstance","getInstance","hide","classList","remove","style","display","setAttribute","removeAttribute","body","overflow","paddingRight","forceCloseAllModals","backdrops","querySelectorAll","forEach","backdrop","parentNode","modals","modal"],"sources":["C:\\xampp\\htdocs\\intranet\\intranet-frontend\\src\\components\\Datos_Usuario.vue"],"sourcesContent":["<template>\r\n  <div class=\"container\">\r\n    <div class=\"col-md-12\">\r\n      <div class=\"card\">\r\n        <!-- Header del Card -->\r\n        <div class=\"card-header d-flex justify-content-between align-items-center\">\r\n          <h5 class=\"mb-0\">Datos personales</h5>\r\n          <div class=\"btn-group\">\r\n            <button\r\n                type=\"button\"\r\n                class=\"btn btn-primary\"\r\n                data-bs-toggle=\"modal\"\r\n                data-bs-target=\"#editModal\"\r\n                :disabled=\"isLoading\"\r\n            >\r\n              <i class=\"fas fa-edit me-1\"></i>Editar\r\n            </button>\r\n            <button\r\n                v-if=\"!user.firma_path\"\r\n                type=\"button\"\r\n                class=\"btn btn-outline-success ms-2\"\r\n                data-bs-toggle=\"modal\"\r\n                data-bs-target=\"#firmaModal\"\r\n                :disabled=\"isLoading\"\r\n            >\r\n              <i class=\"fas fa-signature me-1\"></i>Registrar firma\r\n            </button>\r\n            <button\r\n                v-else\r\n                type=\"button\"\r\n                class=\"btn btn-outline-warning ms-2\"\r\n                data-bs-toggle=\"modal\"\r\n                data-bs-target=\"#firmaModal\"\r\n                :disabled=\"isLoading\"\r\n            >\r\n              <i class=\"fas fa-sync-alt me-1\"></i>Actualizar firma\r\n            </button>\r\n          </div>\r\n        </div>\r\n\r\n        <!-- Body del Card -->\r\n        <div class=\"card-body\">\r\n          <p class=\"card-text text-muted mb-3\">\r\n            Aquí podrás ver y editar tus datos personales como colaborador de la UAF\r\n          </p>\r\n\r\n          <!-- Indicador de firma registrada -->\r\n          <div v-if=\"user.firma_path\" class=\"alert alert-success d-flex align-items-center mb-4\">\r\n            <i class=\"fas fa-check-circle me-2\"></i>\r\n            <span>Firma digital registrada correctamente</span>\r\n            <a\r\n                v-if=\"user.firma_url\"\r\n                :href=\"user.firma_url\"\r\n                target=\"_blank\"\r\n                class=\"btn btn-sm btn-outline-success ms-auto\"\r\n            >\r\n              <i class=\"fas fa-eye me-1\"></i>Ver firma\r\n            </a>\r\n          </div>\r\n\r\n          <!-- Loading indicator -->\r\n          <div v-if=\"isLoading\" class=\"text-center my-4\">\r\n            <div class=\"spinner-border text-primary\" role=\"status\">\r\n              <span class=\"visually-hidden\">Cargando...</span>\r\n            </div>\r\n            <p class=\"mt-2 text-muted\">Cargando datos del usuario...</p>\r\n          </div>\r\n\r\n          <!-- Formulario de datos -->\r\n          <form v-else class=\"pb-4 pt-2\">\r\n            <div class=\"row\">\r\n              <div class=\"col-md-4 mb-3\">\r\n                <label for=\"nombre\" class=\"form-label fw-semibold\">Nombre completo</label>\r\n                <input\r\n                    type=\"text\"\r\n                    class=\"form-control\"\r\n                    id=\"nombre\"\r\n                    v-model=\"user.nombre\"\r\n                    disabled\r\n                    placeholder=\"Nombre no disponible\"\r\n                >\r\n              </div>\r\n\r\n              <div class=\"col-md-4 mb-3\">\r\n                <label for=\"correo_electronico\" class=\"form-label fw-semibold\">Correo Electrónico</label>\r\n                <input\r\n                    type=\"email\"\r\n                    class=\"form-control\"\r\n                    id=\"correo_electronico\"\r\n                    v-model=\"user.correo_electronico\"\r\n                    disabled\r\n                    placeholder=\"Correo no disponible\"\r\n                >\r\n              </div>\r\n\r\n              <div class=\"col-md-4 mb-3\">\r\n                <label for=\"cargo\" class=\"form-label fw-semibold\">Cargo</label>\r\n                <input\r\n                    type=\"text\"\r\n                    class=\"form-control\"\r\n                    id=\"cargo\"\r\n                    v-model=\"user.cargo\"\r\n                    disabled\r\n                    placeholder=\"Cargo no asignado\"\r\n                >\r\n              </div>\r\n\r\n              <div class=\"col-md-4 mb-3\">\r\n                <label for=\"posicion\" class=\"form-label fw-semibold\">Posición</label>\r\n                <input\r\n                    type=\"text\"\r\n                    class=\"form-control\"\r\n                    id=\"posicion\"\r\n                    v-model=\"user.posicion\"\r\n                    disabled\r\n                    placeholder=\"Posición no asignada\"\r\n                >\r\n              </div>\r\n\r\n              <div class=\"col-md-4 mb-3\">\r\n                <label for=\"cedula\" class=\"form-label fw-semibold\">Cédula</label>\r\n                <input\r\n                    type=\"text\"\r\n                    class=\"form-control\"\r\n                    id=\"cedula\"\r\n                    v-model=\"user.cedula\"\r\n                    disabled\r\n                    placeholder=\"Cédula no registrada\"\r\n                >\r\n              </div>\r\n\r\n              <div class=\"col-md-4 mb-3\">\r\n                <label for=\"extension\" class=\"form-label fw-semibold\">Extensión telefónica</label>\r\n                <input\r\n                    type=\"text\"\r\n                    class=\"form-control\"\r\n                    id=\"extension\"\r\n                    v-model=\"user.extension\"\r\n                    disabled\r\n                    placeholder=\"Sin extensión\"\r\n                >\r\n              </div>\r\n\r\n              <div class=\"col-md-4 mb-3\">\r\n                <label for=\"estado\" class=\"form-label fw-semibold\">Estado</label>\r\n                <input\r\n                    type=\"text\"\r\n                    class=\"form-control\"\r\n                    id=\"estado\"\r\n                    v-model=\"user.estado\"\r\n                    disabled\r\n                    :class=\"{'text-success': user.estado === 'activo', 'text-danger': user.estado === 'inactivo'}\"\r\n                >\r\n              </div>\r\n\r\n              <div class=\"col-md-4 mb-3\">\r\n                <label for=\"departamento\" class=\"form-label fw-semibold\">Departamento</label>\r\n                <input\r\n                    type=\"text\"\r\n                    class=\"form-control\"\r\n                    id=\"departamento\"\r\n                    v-model=\"user.departamento\"\r\n                    disabled\r\n                    placeholder=\"Sin departamento asignado\"\r\n                >\r\n              </div>\r\n\r\n              <div class=\"col-md-4 mb-3\">\r\n                <label for=\"horas_extra\" class=\"form-label fw-semibold\">Tiempo extra (horas)</label>\r\n                <input\r\n                    type=\"text\"\r\n                    class=\"form-control\"\r\n                    id=\"horas_extra\"\r\n                    v-model=\"user.tiempo_extra\"\r\n                    disabled\r\n                    placeholder=\"0 horas\"\r\n                >\r\n              </div>\r\n            </div>\r\n          </form>\r\n        </div>\r\n      </div>\r\n    </div>\r\n\r\n    <!-- Modal editar usuario -->\r\n    <div class=\"modal fade\" id=\"editModal\" tabindex=\"-1\" aria-labelledby=\"editModalLabel\" aria-hidden=\"true\">\r\n      <div class=\"modal-dialog modal-lg\">\r\n        <div class=\"modal-content\">\r\n          <div class=\"modal-header\">\r\n            <h5 class=\"modal-title\" id=\"editModalLabel\">\r\n              <i class=\"fas fa-user-edit me-2\"></i>Editar Datos Personales\r\n            </h5>\r\n            <button type=\"button\" class=\"btn-close\" data-bs-dismiss=\"modal\" aria-label=\"Close\"></button>\r\n          </div>\r\n\r\n          <div class=\"modal-body\">\r\n            <form @submit.prevent=\"updateUserData\">\r\n              <div class=\"row\">\r\n                <div class=\"col-md-6 mb-3\">\r\n                  <label for=\"editNombre\" class=\"form-label fw-semibold\">\r\n                    Nombre completo <span class=\"text-danger\">*</span>\r\n                  </label>\r\n                  <input\r\n                      type=\"text\"\r\n                      class=\"form-control\"\r\n                      id=\"editNombre\"\r\n                      v-model=\"editUser.nombre\"\r\n                      :class=\"{'is-invalid': editErrors.nombre}\"\r\n                      required\r\n                  >\r\n                  <div v-if=\"editErrors.nombre\" class=\"invalid-feedback\">\r\n                    {{ editErrors.nombre[0] }}\r\n                  </div>\r\n                </div>\r\n\r\n                <div class=\"col-md-6 mb-3\">\r\n                  <label for=\"editCargo\" class=\"form-label fw-semibold\">\r\n                    Cargo <span class=\"text-danger\">*</span>\r\n                  </label>\r\n                  <input\r\n                      type=\"text\"\r\n                      class=\"form-control\"\r\n                      id=\"editCargo\"\r\n                      v-model=\"editUser.cargo\"\r\n                      :class=\"{'is-invalid': editErrors.cargo}\"\r\n                      required\r\n                  >\r\n                  <div v-if=\"editErrors.cargo\" class=\"invalid-feedback\">\r\n                    {{ editErrors.cargo[0] }}\r\n                  </div>\r\n                </div>\r\n\r\n                <div class=\"col-md-6 mb-3\">\r\n                  <label for=\"editPosicion\" class=\"form-label fw-semibold\">\r\n                    Posición <span class=\"text-danger\">*</span>\r\n                  </label>\r\n                  <input\r\n                      type=\"text\"\r\n                      class=\"form-control\"\r\n                      id=\"editPosicion\"\r\n                      v-model=\"editUser.posicion\"\r\n                      :class=\"{'is-invalid': editErrors.posicion}\"\r\n                      required\r\n                  >\r\n                  <div v-if=\"editErrors.posicion\" class=\"invalid-feedback\">\r\n                    {{ editErrors.posicion[0] }}\r\n                  </div>\r\n                </div>\r\n\r\n                <div class=\"col-md-6 mb-3\">\r\n                  <label for=\"editExtension\" class=\"form-label fw-semibold\">\r\n                    Extensión telefónica <span class=\"text-danger\">*</span>\r\n                  </label>\r\n                  <input\r\n                      type=\"text\"\r\n                      class=\"form-control\"\r\n                      id=\"editExtension\"\r\n                      v-model=\"editUser.extension\"\r\n                      :class=\"{'is-invalid': editErrors.extension}\"\r\n                      required\r\n                  >\r\n                  <div v-if=\"editErrors.extension\" class=\"invalid-feedback\">\r\n                    {{ editErrors.extension[0] }}\r\n                  </div>\r\n                </div>\r\n              </div>\r\n\r\n              <div class=\"mb-3\">\r\n                <label for=\"editFirma\" class=\"form-label fw-semibold\">\r\n                  Actualizar firma digital (opcional)\r\n                </label>\r\n                <input\r\n                    type=\"file\"\r\n                    class=\"form-control\"\r\n                    id=\"editFirma\"\r\n                    accept=\"image/png,image/jpeg,image/jpg\"\r\n                    @change=\"handleEditFirmaFile\"\r\n                />\r\n                <small class=\"form-text text-muted\">\r\n                  Selecciona un archivo solo si deseas cambiar tu firma actual. Formatos: PNG, JPG, JPEG (máx. 2MB)\r\n                </small>\r\n              </div>\r\n\r\n              <div class=\"d-flex justify-content-end gap-2\">\r\n                <button type=\"button\" class=\"btn btn-secondary\" data-bs-dismiss=\"modal\">\r\n                  <i class=\"fas fa-times me-1\"></i>Cancelar\r\n                </button>\r\n                <button type=\"submit\" class=\"btn btn-primary\" :disabled=\"isUpdating\">\r\n                  <span v-if=\"isUpdating\" class=\"spinner-border spinner-border-sm me-2\" role=\"status\"></span>\r\n                  <i v-else class=\"fas fa-save me-1\"></i>\r\n                  {{ isUpdating ? 'Guardando...' : 'Guardar cambios' }}\r\n                </button>\r\n              </div>\r\n            </form>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n\r\n    <!-- Modal subir/actualizar firma -->\r\n    <div class=\"modal fade\" id=\"firmaModal\" tabindex=\"-1\" aria-labelledby=\"firmaModalLabel\" aria-hidden=\"true\">\r\n      <div class=\"modal-dialog\">\r\n        <div class=\"modal-content\">\r\n          <form @submit.prevent=\"uploadFirma\">\r\n            <div class=\"modal-header\">\r\n              <h5 class=\"modal-title\" id=\"firmaModalLabel\">\r\n                <i class=\"fas fa-signature me-2\"></i>\r\n                {{ user.firma_path ? 'Actualizar Firma Digital' : 'Registrar Firma Digital' }}\r\n              </h5>\r\n              <button type=\"button\" class=\"btn-close\" data-bs-dismiss=\"modal\" aria-label=\"Close\"></button>\r\n            </div>\r\n\r\n            <div class=\"modal-body\">\r\n              <div class=\"mb-3\">\r\n                <label for=\"firmaInput\" class=\"form-label fw-semibold\">\r\n                  Seleccionar archivo de imagen <span class=\"text-danger\">*</span>\r\n                </label>\r\n                <input\r\n                    type=\"file\"\r\n                    id=\"firmaInput\"\r\n                    class=\"form-control\"\r\n                    accept=\"image/png,image/jpeg,image/jpg\"\r\n                    @change=\"handleFirmaFile\"\r\n                    required\r\n                    :disabled=\"isUploading\"\r\n                />\r\n                <small class=\"form-text text-muted\">\r\n                  Formatos soportados: PNG, JPG, JPEG. Tamaño máximo: 2MB\r\n                </small>\r\n              </div>\r\n\r\n              <!-- Preview de la imagen seleccionada -->\r\n              <div v-if=\"firmaPreview\" class=\"mb-3\">\r\n                <label class=\"form-label fw-semibold\">Vista previa:</label>\r\n                <div class=\"border rounded p-3 text-center bg-light\">\r\n                  <img\r\n                      :src=\"firmaPreview\"\r\n                      alt=\"Preview de firma\"\r\n                      class=\"img-fluid shadow-sm\"\r\n                      style=\"max-height: 200px; border-radius: 8px;\"\r\n                  >\r\n                </div>\r\n              </div>\r\n\r\n              <!-- Información adicional -->\r\n              <div class=\"alert alert-info\">\r\n                <i class=\"fas fa-info-circle me-2\"></i>\r\n                <small>\r\n                  La firma será procesada automáticamente para eliminar fondos blancos y optimizar su uso en documentos.\r\n                </small>\r\n              </div>\r\n            </div>\r\n\r\n            <div class=\"modal-footer\">\r\n              <button type=\"button\" class=\"btn btn-secondary\" data-bs-dismiss=\"modal\" :disabled=\"isUploading\">\r\n                <i class=\"fas fa-times me-1\"></i>Cancelar\r\n              </button>\r\n              <button type=\"submit\" class=\"btn btn-success\" :disabled=\"!firmaFile || isUploading\">\r\n                <span v-if=\"isUploading\" class=\"spinner-border spinner-border-sm me-2\" role=\"status\"></span>\r\n                <i v-else class=\"fas fa-upload me-1\"></i>\r\n                {{ isUploading ? 'Subiendo...' : (user.firma_path ? 'Actualizar Firma' : 'Subir Firma') }}\r\n              </button>\r\n            </div>\r\n          </form>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport { mapGetters, mapActions } from 'vuex'\r\nimport { Modal } from 'bootstrap'\r\nimport Swal from 'sweetalert2'\r\nimport axios from 'axios'\r\n\r\nexport default {\r\n  name: 'DatosUsuario',\r\n\r\n  computed: {\r\n    ...mapGetters([\r\n      'userProfile',\r\n      'isLoading'\r\n    ]),\r\n\r\n    // Usar datos de Vuex como fuente principal\r\n    user() {\r\n      return this.userProfile || {\r\n        id: null,\r\n        nombre: '',\r\n        correo_electronico: '',\r\n        cargo: '',\r\n        posicion: '',\r\n        cedula: '',\r\n        extension: '',\r\n        estado: '',\r\n        departamento: '',\r\n        tiempo_extra: '',\r\n        firma_path: null,\r\n        firma_url: null\r\n      }\r\n    },\r\n\r\n    // Estado de loading desde Vuex - CORREGIDO\r\n    isLoadingUser() {\r\n      return this.$store.getters.isLoading('userProfile')\r\n    }\r\n  },\r\n\r\n  data() {\r\n    return {\r\n      // Datos para edición\r\n      editUser: {\r\n        nombre: '',\r\n        cargo: '',\r\n        posicion: '',\r\n        extension: ''\r\n      },\r\n\r\n      // Archivos de firma\r\n      firmaFile: null,\r\n      editFirmaFile: null,\r\n      firmaPreview: null,\r\n\r\n      // Instancias de modales\r\n      editModalInstance: null,\r\n      firmaModalInstance: null,\r\n\r\n      // Estados de carga locales\r\n      isUpdating: false,\r\n      isUploading: false,\r\n\r\n      // Errores de validación\r\n      editErrors: {}\r\n    }\r\n  },\r\n\r\n  watch: {\r\n    // Reactivo a cambios en el perfil de usuario desde Vuex\r\n    user: {\r\n      handler(newUser) {\r\n        if (newUser && newUser.nombre) { // VALIDACIÓN AGREGADA\r\n          this.updateEditUserData(newUser)\r\n        }\r\n      },\r\n      immediate: true,\r\n      deep: true // AGREGADO para detectar cambios profundos\r\n    }\r\n  },\r\n\r\n  mounted() {\r\n    // Si no tenemos datos en Vuex, intentar cargarlos\r\n    if (!this.userProfile) {\r\n      this.fetchUserProfile().catch(error => {\r\n        console.error('Error loading user profile:', error)\r\n      })\r\n    }\r\n\r\n    // Inicializar modales con delay para asegurar que el DOM esté listo\r\n    this.$nextTick(() => {\r\n      setTimeout(() => {\r\n        this.initializeModals()\r\n      }, 100) // Pequeño delay para asegurar que el DOM esté completamente renderizado\r\n    })\r\n  },\r\n\r\n  // AGREGADO: Cleanup al desmontar componente\r\n  beforeUnmount() {\r\n    this.cleanupModals()\r\n  },\r\n\r\n  methods: {\r\n    ...mapActions([\r\n      'fetchUserProfile',\r\n      'refreshUserProfile'\r\n    ]),\r\n\r\n    // Actualizar datos de edición basados en el usuario\r\n    updateEditUserData(user) {\r\n      if (!user) return // VALIDACIÓN AGREGADA\r\n\r\n      this.editUser = {\r\n        nombre: user.nombre || '',\r\n        cargo: user.cargo || '',\r\n        posicion: user.posicion || '',\r\n        extension: user.extension || ''\r\n      }\r\n    },\r\n\r\n    // Inicializar modales con validaciones\r\n    initializeModals() {\r\n      try {\r\n        const editModalEl = document.getElementById('editModal')\r\n        const firmaModalEl = document.getElementById('firmaModal')\r\n\r\n        // VALIDACIÓN: Solo inicializar si los elementos existen\r\n        if (editModalEl && !this.editModalInstance) {\r\n          this.editModalInstance = new Modal(editModalEl)\r\n        }\r\n\r\n        if (firmaModalEl && !this.firmaModalInstance) {\r\n          this.firmaModalInstance = new Modal(firmaModalEl)\r\n        }\r\n      } catch (error) {\r\n        console.error('Error inicializando modales:', error)\r\n        // Reintentar después de un segundo\r\n        setTimeout(() => {\r\n          this.initializeModals()\r\n        }, 1000)\r\n      }\r\n    },\r\n\r\n    // NUEVO: Cleanup de modales\r\n    cleanupModals() {\r\n      try {\r\n        if (this.editModalInstance) {\r\n          this.editModalInstance.dispose()\r\n          this.editModalInstance = null\r\n        }\r\n        if (this.firmaModalInstance) {\r\n          this.firmaModalInstance.dispose()\r\n          this.firmaModalInstance = null\r\n        }\r\n      } catch (error) {\r\n        console.error('Error limpiando modales:', error)\r\n      }\r\n    },\r\n\r\n    /**\r\n     * Actualizar datos básicos del usuario\r\n     */\r\n    async updateUserData() {\r\n      this.isUpdating = true\r\n      this.editErrors = {}\r\n\r\n      try {\r\n        const token = localStorage.getItem('auth_token')\r\n\r\n        // Actualizar datos básicos del usuario\r\n        const updateResponse = await axios.put('http://localhost:8000/api/edit_information', this.editUser, {\r\n          headers: {\r\n            'Authorization': `Bearer ${token}`\r\n          }\r\n        })\r\n\r\n        if (!updateResponse.data.status) {\r\n          throw new Error(updateResponse.data.message || 'Error al actualizar datos')\r\n        }\r\n\r\n        // Si hay una nueva firma, subirla\r\n        if (this.editFirmaFile) {\r\n          const formData = new FormData()\r\n          formData.append('firma', this.editFirmaFile)\r\n\r\n          await axios.post('http://localhost:8000/api/upload-firma', formData, {\r\n            headers: {\r\n              'Authorization': `Bearer ${token}`,\r\n              'Content-Type': 'multipart/form-data'\r\n            }\r\n          })\r\n        }\r\n\r\n        // Cerrar modal\r\n        this.closeModal('editModal')\r\n        this.resetEditForm()\r\n\r\n        // Mostrar mensaje de éxito\r\n        await Swal.fire({\r\n          icon: 'success',\r\n          title: 'Datos actualizados',\r\n          text: 'Los datos se han actualizado correctamente',\r\n          timer: 2000,\r\n          showConfirmButton: false,\r\n          allowOutsideClick: true,\r\n          allowEscapeKey: true\r\n        })\r\n\r\n        // Refrescar datos en Vuex\r\n        await this.refreshUserProfile()\r\n\r\n      } catch (error) {\r\n        console.error('Error al actualizar datos:', error)\r\n\r\n        if (error.response?.status === 422) {\r\n          this.editErrors = error.response.data.errors || {}\r\n        }\r\n\r\n        await Swal.fire({\r\n          icon: 'error',\r\n          title: 'Error',\r\n          text: error.response?.data?.message || 'Ha ocurrido un error al actualizar los datos',\r\n          allowOutsideClick: true,\r\n          allowEscapeKey: true\r\n        })\r\n      } finally {\r\n        this.isUpdating = false\r\n        // Limpiar backdrops que puedan haber quedado\r\n        this.removeModalBackdrops()\r\n      }\r\n    },\r\n\r\n    /**\r\n     * Manejar selección de archivo de firma (modal principal)\r\n     */\r\n    handleFirmaFile(e) {\r\n      const file = e.target.files[0]\r\n      if (file) {\r\n        // Validar tamaño (2MB)\r\n        if (file.size > 2 * 1024 * 1024) {\r\n          Swal.fire({\r\n            icon: 'warning',\r\n            title: 'Archivo muy grande',\r\n            text: 'El archivo debe ser menor a 2MB'\r\n          })\r\n          e.target.value = ''\r\n          return\r\n        }\r\n\r\n        this.firmaFile = file\r\n\r\n        // Crear preview de la imagen\r\n        const reader = new FileReader()\r\n        reader.onload = (event) => {\r\n          this.firmaPreview = event.target.result\r\n        }\r\n        reader.readAsDataURL(file)\r\n      } else {\r\n        this.firmaFile = null\r\n        this.firmaPreview = null\r\n      }\r\n    },\r\n\r\n    /**\r\n     * Manejar selección de archivo de firma (modal de edición)\r\n     */\r\n    handleEditFirmaFile(e) {\r\n      const file = e.target.files[0]\r\n      if (file && file.size > 2 * 1024 * 1024) {\r\n        Swal.fire({\r\n          icon: 'warning',\r\n          title: 'Archivo muy grande',\r\n          text: 'El archivo debe ser menor a 2MB'\r\n        })\r\n        e.target.value = ''\r\n        return\r\n      }\r\n      this.editFirmaFile = file\r\n    },\r\n\r\n    /**\r\n     * Subir firma digital\r\n     */\r\n    async uploadFirma() {\r\n      if (!this.firmaFile) {\r\n        Swal.fire({\r\n          icon: 'warning',\r\n          title: 'Atención',\r\n          text: 'Por favor selecciona un archivo de imagen'\r\n        })\r\n        return\r\n      }\r\n\r\n      this.isUploading = true\r\n      const formData = new FormData()\r\n      formData.append('firma', this.firmaFile)\r\n\r\n      try {\r\n        const token = localStorage.getItem('auth_token')\r\n        const response = await axios.post('http://localhost:8000/api/upload-firma', formData, {\r\n          headers: {\r\n            'Authorization': `Bearer ${token}`,\r\n            'Content-Type': 'multipart/form-data'\r\n          }\r\n        })\r\n\r\n        // Cerrar modal\r\n        this.closeModal('firmaModal')\r\n        this.resetFirmaForm()\r\n\r\n        // Mostrar mensaje de éxito\r\n        await Swal.fire({\r\n          icon: 'success',\r\n          title: this.user.firma_path ? 'Firma actualizada' : 'Firma registrada',\r\n          text: 'Tu firma se ha guardado correctamente',\r\n          timer: 2000,\r\n          showConfirmButton: false,\r\n          allowOutsideClick: true,\r\n          allowEscapeKey: true\r\n        })\r\n\r\n        // Refrescar datos en Vuex\r\n        await this.refreshUserProfile()\r\n\r\n      } catch (error) {\r\n        console.error('Error al subir firma:', error)\r\n\r\n        let errorMessage = 'Error al subir la firma'\r\n\r\n        if (error.response?.data?.message) {\r\n          errorMessage = error.response.data.message\r\n        } else if (error.response?.data?.errors) {\r\n          const errors = Object.values(error.response.data.errors).flat()\r\n          errorMessage = errors.join(', ')\r\n        }\r\n\r\n        await Swal.fire({\r\n          icon: 'error',\r\n          title: 'Error',\r\n          text: errorMessage,\r\n          allowOutsideClick: true,\r\n          allowEscapeKey: true\r\n        })\r\n      } finally {\r\n        this.isUploading = false\r\n        this.removeModalBackdrops()\r\n      }\r\n    },\r\n\r\n    // Métodos de utilidad - MEJORADOS con validaciones\r\n    resetFirmaForm() {\r\n      this.firmaFile = null\r\n      this.firmaPreview = null\r\n      const input = document.getElementById('firmaInput')\r\n      if (input) input.value = ''\r\n    },\r\n\r\n    resetEditForm() {\r\n      this.editFirmaFile = null\r\n      this.editErrors = {}\r\n      const editFirmaInput = document.getElementById('editFirma')\r\n      if (editFirmaInput) editFirmaInput.value = ''\r\n    },\r\n\r\n    closeModal(modalId) {\r\n      try {\r\n        const modalElement = document.getElementById(modalId)\r\n        if (!modalElement) {\r\n          console.warn(`Modal element ${modalId} not found`)\r\n          return\r\n        }\r\n\r\n        const modalInstance = Modal.getInstance(modalElement)\r\n        if (modalInstance) {\r\n          modalInstance.hide()\r\n        }\r\n\r\n        // Método alternativo de cierre\r\n        modalElement.classList.remove('show')\r\n        modalElement.style.display = 'none'\r\n        modalElement.setAttribute('aria-hidden', 'true')\r\n        modalElement.removeAttribute('aria-modal')\r\n        modalElement.removeAttribute('role')\r\n\r\n        // Limpiar backdrops\r\n        this.removeModalBackdrops()\r\n\r\n        // Restaurar el scroll del body\r\n        document.body.classList.remove('modal-open')\r\n        document.body.style.overflow = ''\r\n        document.body.style.paddingRight = ''\r\n\r\n      } catch (error) {\r\n        console.error('Error al cerrar modal:', error)\r\n        // Método de emergencia\r\n        this.forceCloseAllModals()\r\n      }\r\n    },\r\n\r\n    removeModalBackdrops() {\r\n      try {\r\n        const backdrops = document.querySelectorAll('.modal-backdrop')\r\n        backdrops.forEach(backdrop => {\r\n          if (backdrop && backdrop.parentNode) { // VALIDACIÓN AGREGADA\r\n            backdrop.remove()\r\n          }\r\n        })\r\n      } catch (error) {\r\n        console.error('Error removing backdrops:', error)\r\n      }\r\n    },\r\n\r\n    forceCloseAllModals() {\r\n      try {\r\n        // Remover todas las clases y elementos relacionados con modales\r\n        document.body.classList.remove('modal-open')\r\n        document.body.style.overflow = ''\r\n        document.body.style.paddingRight = ''\r\n\r\n        // Cerrar todos los modales\r\n        const modals = document.querySelectorAll('.modal')\r\n        modals.forEach(modal => {\r\n          if (modal) { // VALIDACIÓN AGREGADA\r\n            modal.classList.remove('show')\r\n            modal.style.display = 'none'\r\n            modal.setAttribute('aria-hidden', 'true')\r\n            modal.removeAttribute('aria-modal')\r\n            modal.removeAttribute('role')\r\n          }\r\n        })\r\n\r\n        // Remover todos los backdrops\r\n        this.removeModalBackdrops()\r\n      } catch (error) {\r\n        console.error('Error in force close all modals:', error)\r\n      }\r\n    }\r\n  }\r\n}\r\n</script>\r\n\r\n<style scoped>\r\n.spinner-border-sm {\r\n  width: 1rem;\r\n  height: 1rem;\r\n}\r\n\r\n.alert {\r\n  border-radius: 0.5rem;\r\n}\r\n\r\n.img-fluid {\r\n  border-radius: 0.375rem;\r\n}\r\n\r\n.card {\r\n  border: none;\r\n  box-shadow: 0 0.125rem 0.25rem rgba(0, 0, 0, 0.075);\r\n}\r\n\r\n.card-header {\r\n  background-color: #f8f9fa;\r\n  border-bottom: 1px solid #dee2e6;\r\n}\r\n\r\n.form-label {\r\n  color: #495057;\r\n  margin-bottom: 0.5rem;\r\n}\r\n\r\n.form-control:disabled {\r\n  background-color: #f8f9fa;\r\n  border-color: #e9ecef;\r\n}\r\n\r\n.btn-group .btn {\r\n  border-radius: 0.375rem;\r\n}\r\n\r\n.btn-group .btn:not(:last-child) {\r\n  margin-right: 0.5rem;\r\n}\r\n\r\n.modal-content {\r\n  border: none;\r\n  box-shadow: 0 0.5rem 1rem rgba(0, 0, 0, 0.15);\r\n}\r\n\r\n.modal-header {\r\n  border-bottom: 1px solid #dee2e6;\r\n  background-color: #f8f9fa;\r\n}\r\n\r\n.modal-footer {\r\n  border-top: 1px solid #dee2e6;\r\n  background-color: #f8f9fa;\r\n}\r\n\r\n.text-success {\r\n  color: #198754 !important;\r\n}\r\n\r\n.text-danger {\r\n  color: #dc3545 !important;\r\n}\r\n\r\n.fw-semibold {\r\n  font-weight: 600;\r\n}\r\n\r\n.gap-2 {\r\n  gap: 0.5rem;\r\n}\r\n</style>"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}